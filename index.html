<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hw-17</title>
</head>
<body>
    <script>
        class List {
            _list = [];
            _storageName;

            get storageName(){
                return this._storageName;
            }
            get list(){
                return this._list;
            }
            constructor(storageName) {
                this._storageName = storageName;
                this.firstLoad();
            }
            add(...args) {
                if (args.length) {
                    let value = args.join(' ');
                    const id = Date.now();
                    if (this.isString(value)) {
                        value = value.trim();
                    };
                    this.list.push({
                        value: value,
                        id,
                    });
                    this.sendToStorage();
                }
            }
            remove(element) {
                const index = this.getIndex(element);
                if (index != -1) {
                    this.list.splice(index, 1);
                };
                this.sendToStorage();
            }
            edit(element, newValue) {
                const index = this.getIndex(element);
                if (index != -1) {
                    this.list[index].value = newValue.trim();
                };
                this.sendToStorage();
            }
            isNumber(element) {
                return (element && typeof element === 'number') ? true : false;
            }
            isString(element) {
                return (element && typeof element === 'string') ? true : false;
            }
            getIndex(value) {
                if (this.list.length) {
                    let property;
                    if (this.isNumber(value)) {
                        property = 'id';
                    } else if (this.isString(value)) {
                        property = 'value';
                    };
                    return this.list.findIndex(obj => {if(obj[property] === value) return obj});
                };
            }
            checkStorage() {
                const storage = localStorage.getItem(this.storageName);
                const storageString = JSON.stringify(this.list);

                if (storage) {
                    if (storage === storageString) {
                        return;
                    };
                };
                return storageString;
            }
            sendToStorage() {
                const storageString = this.checkStorage();
                if (storageString) {
                    localStorage.removeItem(this.storageName);
                    localStorage.setItem(this.storageName, storageString);
                }
            }
            firstLoad() {
                const storage = JSON.parse(localStorage.getItem(this.storageName));

                if (!this.list.length && storage && storage.length) {
                    storage.forEach(element => {
                        this.list.push(element);
                    });
                }
            }
        };
        class TodoList extends List{
            add(...args) {
                super.add(...args);
                if (this.list.length) {
                    this.list[this.list.length - 1].isComplete = false;
                    this.sendToStorage();   
                }
            }
            setComplete(id) {
                const index = this.getIndex(id);
                if (index != -1) {
                    this.list[index].isComplete = true;
                };
                this.sendToStorage();
            }
            getStatus() {
                return {
                    all: this.list.length,
                    completed: this.list.filter(elem => elem.isComplete ? true : false).length,
                }
            }
        }
        class ContactList extends List {
            findMatches(value){
                if (this.isString(value) && this.list.length) {
                    const result = this.list.filter(element => element.value.includes(value));
                    return result.length ? result : 'Нет такого';
                }
            }
        }
    </script>
</body>
</html>